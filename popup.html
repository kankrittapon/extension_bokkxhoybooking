<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>การเข้าถึง Booker</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      margin: 0;
      padding: 0;
      width: 360px;
      min-height: 460px;
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #3f51b5 0%, #673ab7 100%);
      color: #fff;
    }
    .container {
      padding: 20px 22px 30px;
    }
    .header {
      text-align: center;
      margin-bottom: 18px;
    }
    .header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
    }
    .header p {
      margin: 8px 0 0;
      font-size: 13px;
      opacity: 0.85;
    }
    .card {
      background: rgba(255, 255, 255, 0.12);
      border-radius: 14px;
      padding: 18px;
      backdrop-filter: blur(12px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.18);
      margin-bottom: 16px;
    }
    .hidden { display: none; }
    .form-label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 6px;
      letter-spacing: 0.3px;
    }
    input[type="text"],
    input[type="password"],
    input[type="datetime-local"],
    select {
      width: 100%;
      padding: 10px 12px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
      margin-bottom: 14px;
      color: #222;
      box-sizing: border-box;
    }
    input[type="text"]:focus,
    input[type="password"]:focus,
    input[type="datetime-local"]:focus,
    select:focus {
      outline: 2px solid rgba(255, 255, 255, 0.45);
    }
    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.18s ease, opacity 0.18s ease;
    }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .btn.primary { background: #4caf50; color: #fff; }
    .btn.primary:hover { transform: translateY(-1px); }
    .btn.secondary { background: rgba(255, 255, 255, 0.18); color: #fff; }
    .btn.danger { background: #e53935; color: #fff; }
    .row-buttons {
      display: flex;
      gap: 10px;
    }
    .row-buttons .btn { flex: 1; }
    .message {
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 13px;
      margin-bottom: 14px;
      background: rgba(255, 255, 255, 0.16);
      display: none;
    }
    .message.info { background: rgba(33, 150, 243, 0.25); }
    .message.error { background: rgba(244, 67, 54, 0.28); }
    .message.success { background: rgba(76, 175, 80, 0.3); }
    .message.show { display: block; }
    .hint {
      margin: 12px 0 0;
      font-size: 12px;
      opacity: 0.7;
      text-align: center;
    }
    .link-btn {
      width: 100%;
      background: transparent;
      border: none;
      color: #fff;
      text-decoration: underline;
      cursor: pointer;
      font-size: 13px;
      padding: 6px 0;
      margin-top: 6px;
    }
    .link-btn:disabled {
      opacity: 0.55;
      cursor: not-allowed;
      text-decoration: none;
    }
    .loading-indicator {
      margin-top: 12px;
      font-size: 12px;
      opacity: 0.8;
      display: none;
      text-align: center;
    }
    .loading .loading-indicator { display: block; }
    .session-row {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }
    .session-label {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      opacity: 0.8;
    }
    .session-value {
      font-size: 14px;
      font-weight: 600;
      margin-top: 4px;
    }
    .session-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.22);
      font-size: 13px;
      font-weight: 600;
      margin-top: 4px;
    }
    .session-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 18px;
      gap: 10px;
    }
    .session-actions .btn { flex: 1; }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1>การเข้าถึง Booker</h1>
      <p>เข้าสู่ระบบเพื่อใช้งาน</p>
    </header>

    <div id="message" class="message"></div>

    <section id="sessionView" class="card hidden">
      <div class="session-row">
        <div>
          <div class="session-label">ผู้ใช้</div>
          <div id="sessionName" class="session-value">-</div>
        </div>
        <div>
          <div class="session-label">สิทธิ์</div>
          <div id="sessionRole" class="session-badge">-</div>
        </div>
      </div>
      <div class="session-row">
        <div>
          <div class="session-label">วันหมดอายุ</div>
          <div id="sessionExpiry" class="session-value">-</div>
        </div>
        <div>
          <div class="session-label">ตรวจสอบล่าสุด</div>
          <div id="sessionChecked" class="session-value">-</div>
        </div>
      </div>
      <div class="session-actions">
        <button id="refreshSessionBtn" class="btn secondary" type="button">รีเฟรช</button>
        <button id="logoutBtn" class="btn danger" type="button">ออกจากระบบ</button>
      </div>
      <div id="sessionLoading" class="loading-indicator">กำลังตรวจสอบสถานะ...</div>
    </section>

    <section id="loginView" class="card">
      <form id="loginForm">
        <label class="form-label" for="username">ชื่อผู้ใช้</label>
        <input id="username" name="username" type="text" autocomplete="username" required />
        <label class="form-label" for="password">รหัสผ่าน</label>
        <input id="password" name="password" type="password" autocomplete="current-password" required />
        <button id="loginBtn" class="btn primary" type="submit">เข้าสู่ระบบ</button>
      </form>
      <button id="showRegisterBtn" class="link-btn" type="button">สร้างบัญชีใหม่</button>
      <p class="hint">ยังไม่มีบัญชี? ติดต่อผู้ดูแล</p>
    </section>

    <section id="registerView" class="card hidden">
      <form id="registerForm">
        <label class="form-label" for="registerUsername">ชื่อผู้ใช้</label>
        <input id="registerUsername" name="registerUsername" type="text" autocomplete="username" required />
        <label class="form-label" for="registerPassword">รหัสผ่าน</label>
        <input id="registerPassword" name="registerPassword" type="password" autocomplete="new-password" required />
        <label class="form-label" for="registerConfirm">ยืนยันรหัสผ่าน</label>
        <input id="registerConfirm" name="registerConfirm" type="password" autocomplete="new-password" required />
        <label class="form-label" for="registerRole">สิทธิ์การใช้งาน</label>
        <select id="registerRole" name="registerRole">
          <option value="user">ผู้ใช้ (user)</option>
          <option value="viewer">ผู้ชม (viewer)</option>
          <option value="admin">ผู้ดูแล (admin)</option>
        </select>
        <label class="form-label" for="registerExpires">วันหมดอายุ</label>
        <input id="registerExpires" name="registerExpires" type="datetime-local" required />
        <label class="form-label" for="registerAdminKey">คีย์ผู้ดูแล (ถ้าจำเป็น)</label>
        <input id="registerAdminKey" name="registerAdminKey" type="password" autocomplete="off" placeholder="ไม่บังคับ" />
        <div class="row-buttons">
          <button id="registerBtn" class="btn primary" type="submit">สร้างบัญชี</button>
          <button id="backToLoginBtn" class="btn secondary" type="button">ย้อนกลับ</button>
        </div>
      </form>
      <p class="hint">ปล่อยคีย์ผู้ดูแลว่างได้เฉพาะตอนสร้างบัญชีแรกเท่านั้น</p>
    </section>
  </div>
  <script src="popup.js"></script>
</body>
</html>
